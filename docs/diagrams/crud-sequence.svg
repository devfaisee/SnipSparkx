<svg xmlns="http://www.w3.org/2000/svg" width="1300" height="760" font-family="'Segoe UI', Arial, sans-serif">
  <style>
    .title { font-size: 24px; font-weight: 600; }
    .subtitle { font-size: 14px; fill: #475569; }
    .lane { fill: #f8fafc; stroke: #94a3b8; stroke-width: 2; }
    .lane-label { font-size: 14px; font-weight: 600; fill: #0f172a; }
    .step { font-size: 13px; fill: #0f172a; }
    .arrow { stroke: #0f172a; stroke-width: 2; marker-end: url(#arrowhead); }
    .note { fill: #e0f2fe; stroke: #0ea5e9; stroke-width: 1.5; rx: 8; }
  </style>

  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#0f172a" />
    </marker>
  </defs>

  <text x="650" y="48" text-anchor="middle" class="title">SnipSparkx â€“ CRUD Flow (End to End)</text>
  <text x="650" y="72" text-anchor="middle" class="subtitle">Matches admin.html client logic, serverless APIs, SnippetStore persistence</text>

  <!-- Swimlanes -->
  <g transform="translate(60,110)">
    <rect class="lane" width="220" height="520" rx="16" />
    <text x="110" y="-12" text-anchor="middle" class="lane-label">Admin User</text>
  </g>
  <g transform="translate(300,110)">
    <rect class="lane" width="220" height="520" rx="16" />
    <text x="110" y="-12" text-anchor="middle" class="lane-label">Browser / UI</text>
  </g>
  <g transform="translate(540,110)">
    <rect class="lane" width="240" height="520" rx="16" />
    <text x="120" y="-12" text-anchor="middle" class="lane-label">Serverless API</text>
  </g>
  <g transform="translate(820,110)">
    <rect class="lane" width="200" height="520" rx="16" />
    <text x="100" y="-12" text-anchor="middle" class="lane-label">Auth Helper</text>
  </g>
  <g transform="translate(1040,110)">
    <rect class="lane" width="200" height="520" rx="16" />
    <text x="100" y="-12" text-anchor="middle" class="lane-label">SnippetStore</text>
  </g>

  <!-- Steps -->
  <text x="90" y="180" class="step">1. Admin fills form + clicks Save</text>
  <line class="arrow" x1="180" y1="190" x2="300" y2="190" />

  <text x="320" y="230" class="step">2. Browser packs title, description, HTML, CSS + JWT token</text>
  <line class="arrow" x1="410" y1="250" x2="540" y2="250" />

  <text x="560" y="300" class="step">3. API endpoint (add/update/delete) receives fetch() payload</text>
  <line class="arrow" x1="660" y1="320" x2="820" y2="320" />

  <text x="840" y="360" class="step">4. Auth helper validates Authorization: Bearer &lt;token&gt;</text>
  <line class="arrow" x1="920" y1="380" x2="660" y2="380" />

  <text x="560" y="420" class="step">5. API sanitizes input + calls SnippetStore add/update/delete</text>
  <line class="arrow" x1="660" y1="440" x2="1040" y2="440" />

  <text x="1060" y="480" class="step">6. SnippetStore writes public/snippets.json (+ optional GitHub commit)</text>
  <line class="arrow" x1="1040" y1="500" x2="660" y2="500" />

  <text x="560" y="540" class="step">7. API returns JSON (success/error + snippet data)</text>
  <line class="arrow" x1="660" y1="560" x2="300" y2="560" />

  <text x="320" y="600" class="step">8. UI shows toast, refreshes list, updates preview iframe</text>
  <line class="arrow" x1="410" y1="620" x2="180" y2="620" />

  <!-- Note -->
  <g transform="translate(160,660)">
    <rect class="note" width="980" height="50" />
    <text x="490" y="690" text-anchor="middle" class="step">References: admin.html (dashboard JS), api/addSnippet.js, api/updateSnippet.js, api/deleteSnippet.js, api/_lib/auth.js, api/_lib/store.js</text>
  </g>
</svg>
