<svg xmlns="http://www.w3.org/2000/svg" width="1500" height="900" font-family="'Segoe UI', Tahoma, sans-serif">
  <defs>
    <style>
      .title { font-size: 26px; font-weight: 700; fill: #1e293b; }
      .subtitle { font-size: 14px; fill: #64748b; }
      .lane { fill: #f8fafc; stroke: #cbd5e1; stroke-width: 2; }
      .lane-label { font-size: 15px; font-weight: 600; fill: #1e293b; }
      .lifeline { stroke: #cbd5e1; stroke-width: 2; stroke-dasharray: 8,4; }
      .activation { fill: #dbeafe; stroke: #3b82f6; stroke-width: 2; }
      .message { stroke: #3b82f6; stroke-width: 2.5; fill: none; marker-end: url(#arrow-blue); }
      .return-message { stroke: #10b981; stroke-width: 2; fill: none; marker-end: url(#arrow-green); stroke-dasharray: 6,3; }
      .message-label { font-size: 13px; fill: #0f172a; font-weight: 500; }
      .step-number { font-size: 12px; fill: #ffffff; font-weight: 700; }
      .step-circle { fill: #3b82f6; }
      .note-box { fill: #fef3c7; stroke: #f59e0b; stroke-width: 1.5; rx: 8; }
      .note-text { font-size: 12px; fill: #78350f; }
    </style>
    <marker id="arrow-blue" markerWidth="12" markerHeight="12" refX="11" refY="6" orient="auto">
      <path d="M 0 0 L 12 6 L 0 12 L 3 6 Z" fill="#3b82f6" />
    </marker>
    <marker id="arrow-green" markerWidth="10" markerHeight="10" refX="10" refY="5" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 L 2 5 Z" fill="#10b981" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="750" y="50" text-anchor="middle" class="title">SnipSparkx CRUD Flow</text>
  <text x="750" y="75" text-anchor="middle" class="subtitle">End-to-end sequence showing how snippet creation, updates, and deletion work</text>

  <!-- Swimlanes -->
  <g id="lanes">
    <g transform="translate(50, 120)">
      <rect class="lane" width="220" height="700" rx="12"/>
      <text x="110" y="30" text-anchor="middle" class="lane-label">Admin User</text>
      <line x1="110" y1="50" x2="110" y2="700" class="lifeline"/>
    </g>
    
    <g transform="translate(300, 120)">
      <rect class="lane" width="240" height="700" rx="12"/>
      <text x="120" y="30" text-anchor="middle" class="lane-label">Browser / UI</text>
      <line x1="120" y1="50" x2="120" y2="700" class="lifeline"/>
    </g>
    
    <g transform="translate(570, 120)">
      <rect class="lane" width="260" height="700" rx="12"/>
      <text x="130" y="30" text-anchor="middle" class="lane-label">API Endpoint</text>
      <line x1="130" y1="50" x2="130" y2="700" class="lifeline"/>
    </g>
    
    <g transform="translate(860, 120)">
      <rect class="lane" width="240" height="700" rx="12"/>
      <text x="120" y="30" text-anchor="middle" class="lane-label">AuthHelper</text>
      <line x1="120" y1="50" x2="120" y2="700" class="lifeline"/>
    </g>
    
    <g transform="translate(1130, 120)">
      <rect class="lane" width="300" height="700" rx="12"/>
      <text x="150" y="30" text-anchor="middle" class="lane-label">SnippetStore</text>
      <line x1="150" y1="50" x2="150" y2="700" class="lifeline"/>
    </g>
  </g>

  <!-- Step 1: Form Submission -->
  <g id="step1">
    <circle class="step-circle" cx="90" cy="220" r="14"/>
    <text x="90" y="225" text-anchor="middle" class="step-number">1</text>
    <line class="message" x1="160" y1="220" x2="300" y2="220"/>
    <text x="180" y="210" class="message-label">Fills form &amp; clicks Save</text>
  </g>

  <!-- Step 2: Browser packs data -->
  <g id="step2">
    <rect class="activation" x="410" y="240" width="40" height="60" rx="4"/>
    <circle class="step-circle" cx="340" cy="260" r="14"/>
    <text x="340" y="265" text-anchor="middle" class="step-number">2</text>
    <line class="message" x1="420" y1="260" x2="570" y2="260"/>
    <text x="440" y="250" class="message-label">POST with payload + JWT</text>
  </g>

  <!-- Step 3: API receives request -->
  <g id="step3">
    <rect class="activation" x="690" y="280" width="40" height="100" rx="4"/>
    <circle class="step-circle" cx="630" cy="300" r="14"/>
    <text x="630" y="305" text-anchor="middle" class="step-number">3</text>
    <text x="640" y="320" class="message-label">Receives request</text>
  </g>

  <!-- Step 4: Auth verification -->
  <g id="step4">
    <rect class="activation" x="970" y="340" width="40" height="60" rx="4"/>
    <circle class="step-circle" cx="900" cy="350" r="14"/>
    <text x="900" y="355" text-anchor="middle" class="step-number">4</text>
    <line class="message" x1="730" y1="350" x2="860" y2="350"/>
    <text x="750" y="340" class="message-label">verify(JWT token)</text>
    <line class="return-message" x1="970" y1="370" x2="730" y2="370"/>
    <text x="800" y="388" class="message-label">âœ“ valid</text>
  </g>

  <!-- Step 5: Sanitize and prepare -->
  <g id="step5">
    <circle class="step-circle" cx="630" cy="410" r="14"/>
    <text x="630" y="415" text-anchor="middle" class="step-number">5</text>
    <text x="640" y="430" class="message-label">Sanitize HTML input</text>
  </g>

  <!-- Step 6: Call SnippetStore -->
  <g id="step6">
    <rect class="activation" x="1270" y="450" width="40" height="120" rx="4"/>
    <circle class="step-circle" cx="1100" cy="470" r="14"/>
    <text x="1100" y="475" text-anchor="middle" class="step-number">6</text>
    <line class="message" x1="730" y1="470" x2="1130" y2="470"/>
    <text x="850" y="460" class="message-label">add/update/delete(snippet)</text>
  </g>

  <!-- Step 7: Persist data -->
  <g id="step7">
    <circle class="step-circle" cx="1220" cy="510" r="14"/>
    <text x="1220" y="515" text-anchor="middle" class="step-number">7</text>
    <text x="1230" y="530" class="message-label">Write to snippets.json</text>
    <text x="1230" y="548" class="note-text">(+ optional GitHub commit)</text>
  </g>

  <!-- Step 8: Return result -->
  <g id="step8">
    <circle class="step-circle" cx="1100" cy="590" r="14"/>
    <text x="1100" y="595" text-anchor="middle" class="step-number">8</text>
    <line class="return-message" x1="1270" y1="590" x2="730" y2="590"/>
    <text x="950" y="580" class="message-label">Return snippet data</text>
  </g>

  <!-- Step 9: API responds -->
  <g id="step9">
    <circle class="step-circle" cx="630" cy="630" r="14"/>
    <text x="630" y="635" text-anchor="middle" class="step-number">9</text>
    <line class="return-message" x1="690" y1="630" x2="420" y2="630"/>
    <text x="500" y="620" class="message-label">JSON response (200 OK)</text>
  </g>

  <!-- Step 10: UI updates -->
  <g id="step10">
    <circle class="step-circle" cx="340" cy="670" r="14"/>
    <text x="340" y="675" text-anchor="middle" class="step-number">10</text>
    <line class="return-message" x1="410" y1="670" x2="160" y2="670"/>
    <text x="200" y="660" class="message-label">Show toast &amp; refresh</text>
  </g>

  <!-- Step 11: Display update -->
  <g id="step11">
    <circle class="step-circle" cx="90" cy="710" r="14"/>
    <text x="90" y="715" text-anchor="middle" class="step-number">11</text>
    <text x="100" y="730" class="message-label">See updated list</text>
  </g>

  <!-- Note Box -->
  <g transform="translate(100, 840)">
    <rect class="note-box" width="1300" height="50" />
    <text x="650" y="25" text-anchor="middle" class="note-text">Backend logging: Each step logs to console with [ENDPOINT_NAME] prefix showing method, auth status, payload info, and responses</text>
    <text x="650" y="42" text-anchor="middle" class="note-text">Files: api/addSnippet.js, api/updateSnippet.js, api/deleteSnippet.js, api/_lib/auth.js, api/_lib/store.js</text>
  </g>
</svg>
